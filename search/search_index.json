{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Interested in contributing? We'd love to have you on board! Click here</p> <p>Want to skip to the server installation guide? Click here</p> <p>Have a question? It might be in here</p>"},{"location":"#what-is-fosscord","title":"What is Fosscord?","text":"<p>Fosscord is a Discord.com server implementation and extension, with the goal of complete feature parity with Discord.com, all while adding some additional goodies, security, privacy, and configuration options.</p> <p>Fosscord allows you to host a complete, Discord.com-compatible chat service with complete control over it's content, usage, security, configuration, and featureset. Being Discord.com-compatible will allow all existing clients, bots, and applications written for Discord.com to be used on any Fosscord instance, which we believe will be immensely useful for any transition process between services.</p> <p>As Fosscord is an entirely separate service from Discord.com, it means a Fosscord server by itself cannot access private data controlled by Discord.com. You cannot use a Fosscord server to chat with your friends on Discord.com. You also cannot use a Fosscord server to grant premium (\"Nitro\") features to a Discord.com account (although you can grant these to a Fosscord account).</p> <p>Our goal is to achieve complete feature parity with Discord.com, as well as implement additional security, privacy, and other useful features serverside. In addition to our server software, we aim to create Fosscord-aware clients that can be used to connect to multiple Fosscord-compatible instances with rich theming and plugin support.</p>"},{"location":"#support","title":"Support","text":"<p>For any kind of support regarding Fosscord, feel free to ask questions in our Discord.com server or our official Fosscord instance.</p> <p>For bug reporting and feature requests please create an issue on Github.</p>"},{"location":"faq/","title":"Frequently Asked Questions","text":"Voice/Video when? <p>Currently there is no voice or video support in any Fosscord instance. This is a very difficult feature to get working, especially given that we must implement it the exact same way as Discord.com for client compatibility. We would be incredibly thankful for any assistance.</p> Free Nitro? <p>Please do not use Discord trademarks to refer to anything regarding Fosscord. As an instance owner, you can grant yourself or others premium features which may be used to determine your abilities client-side. However, Fosscord-server currently does not have any distinction between premium and free users. All users can access all features, given they have the rights to do so.</p> <p>You cannot give yourself premium features on Discord.com using a Fosscord instance.</p> How do I boost my guild? Or, how do I buy premium? <p>You cannot buy premium features through Fosscord, as Fosscord does not support any payment backend.</p> <p>Additionally, Fosscord does not currently have any distinction between premium and free users or guilds. All users and guilds have access to all features server-side.</p> <p>In the case of users, you may run into issues with the client preventing you from using certain features, if the user's <code>premium_type</code> or <code>premium</code> values are not set correctly. By default, Fosscord will do this for you, however.</p> <p>In the case of guilds, you may run into issues with uploading animated icons or banners, etc. If so, simply give the guild the features you require. You can set them to be given to all guilds by default using the config <code>guild_defaultFeatures</code> array.</p> Can I log in with my Discord account? <p>No. Fosscord and Discord are entirely separate services, with their own separate databases and authentication. Fosscord cannot access any private data from Discord.com. As always, you should not provide login credentials for Discord.com, or any other service, to others.</p> Does Fosscord use the same servers as Discord? <p>No. Discord servers, as in the bare-metal running the service, are completely inaccessible to people, outside of course the Discord.com service provided. It is impossible for us to use their infrastructure. Fosscord instances are hosted entirely by their owner(s).</p> <p>If you mean Discord 'server' as in a guild, also no. Fosscord is not a proxy for Discord guilds. Fosscord does not create Discord.com accounts or ask for your own at any time (outside of OAuth features provided by the instance such as account connections or 'login with' buttons) If Fosscord was to try this, Discord's automated spam filters would surely block your instance, and ban any offending accounts.</p> <p>Lastly, you can simply view our codebase. A simple proxy would not need to be this complex or large. We implement the entire Discord.com API, Gateway, among others. None of this would be necessary if we were simply abusing Discord.com.</p> Do you use Discord.com code? <p>Absolutely not. If a potential contributor makes any indication of being a Discord employee, or to have access to leaked Discord.com code, we take measures in line with our Code of Conduct to ensure the Fosscord codebase is free of any proprietary code. We want absolutely nothing to do with it.</p> What about the test client? That's just the Discord.com one! <p>Yes, this is true. However, this is purely for testing and development purposes. Fosscord is first and foremost a backend server implementation, and we simply use Discord.com's client to verify our work as correct. Efforts are being made to move away from this with our own client, but as you may have guessed, building a Discord-compatible client is difficult.</p> <p>You can read more about the test client here</p> Is this illegal? <p>The Fosscord maintainers do not believe it to be, no. See: Oracle v. Google. The only aspect of Fosscord that is not entirely written by us is the test client which we simply proxy from Discord.com, and we take measures to show that the client is purely for development and research purposes.</p> Why are you doing this, anyway? <ol> <li>We love free, open source software.</li> <li>There are many existing bots, applications, users, features, and ideas surrounding Discord.com.</li> <li>Fosscord allows these users and developers to maintain a familiar ecosystem with minimal friction.</li> <li>Reimplementing allows us to extend the Discord protocol in ways Discord.com may not deem feasible, economical, whateverical.</li> <li>This includes privacy features, such as end to end encryption for example.</li> <li>The reverse engineering effort by our team may be useful to outside developers looking to understand how similar services work.</li> <li>The Discord protocol, despite its API complexity, is quite simple and linear. No complex conflict resolution like Matrix, for example.</li> </ol> Editing the database is annoying, is there a graphical interface for this? <p>Currently no, there is no graphical interface for managing your Fosscord instance. An admin dashboard is planned, but we currently have higher priorities right now.</p> When will this feature be available? <p>We do not provide ETAs. Users tend to take them as deadlines, and for a small team of &lt;5 maintainers who do not get payment for their work, this is unreasonable.</p> It's pretty funny how you have a Discord.com guild for support. <p>We know. Also that's not a question.</p>"},{"location":"routes/","title":"API Routes","text":""},{"location":"contributing/","title":"Contributing","text":"<p>Have you read the Code of Conduct?</p>"},{"location":"contributing/#style-and-a-note-on-etiquette","title":"Style and a note on etiquette","text":"<ul> <li>We use prettier for code formatting. We have a <code>.prettierrc</code> file in fosscord-server's root     and use a git precommit hook to autorun it.</li> <li>Try to stay consistent with the rest of the project</li> <li>Try to keep each commit to a single feature or idea, with descriptions of what it is and why it is done. No \"Large refactor\" commits that touch every file,     unless absolutely required due to the nature of change.</li> <li>Leave comments in your code about why something is done when appropriate, not just what it is doing.</li> <li>If you're working on a feature, please announce that you're working on it (in the relevant GH issue or our Discord, preferably both),     so that we can work more effectively and minimise conflicting change attempts.     Additionally, please do not try to snipe features that others are working on.</li> </ul>"},{"location":"contributing/#structure","title":"Structure","text":"<p>Fosscord is written in Typescript and is comprised of 4 main parts:</p> <ul> <li>REST HTTP API server</li> <li>Websocket Gateway server for realtime communication with clients</li> <li>HTTP CDN server for storing user file content.</li> <li><code>utils</code> module to separate our database models, schemas, and other things from the above 3 components.</li> </ul>"},{"location":"contributing/#implementing-endpoints-opcodes-etc","title":"Implementing endpoints, opcodes, etc","text":"<p>Generally, the approach is to just see what the Discord.com client sends and receives from Discord.com (through your browsers devtools, for example) and guessing about any functionality server-side, if it's undocumented.</p> <p>For a lot of things it's pretty simple to guess, <code>GET /api/users/@me</code> returns private details about your user for example. This route is also detailed in Discords own documentation, here specifically.</p> <p>Discord generally does not document anything that is not related to application/bot development, though. As an example, <code>GET /api/updates?platform={}</code> which returns the <code>url</code>, <code>pub_date</code>, <code>name</code> and any <code>notes</code> about the latest client release for a platform.</p> <p>For the Gateway it's the same procedure, except now you can't use the network logger of your devtools because the gateway returns responses encoded with erlpack. Easy fix though, just edit the <code>DeveloperOptionsStore</code> localStorage key so that <code>logGatewayEvents</code> is true, and reload the client.</p> <p>Warning</p> <p>Make sure you rerun <code>npm run build</code> every time you edit source code. Additionally, make sure you run <code>npm run generate:schema</code> whenever you change a schema. If you want to do both, there's a shortcut: <code>npm run setup</code>.</p>"},{"location":"contributing/conduct/","title":"Code of Conduct","text":"<p>By contributing to or interacting with Fosscord or Fosscord community spaces, you accept the code of conduct.</p> <p>This code of conduct is based on the Artemis Lena Code of Conduct by FantasyCookie17. As it is licensed under CC0, it may be used by other communities in modified or unmodified form without permission from the author. Its purpose is to ensure a civilised, tolerant, compassionate, helpful, pluralistic, and peaceful style of communication.</p> <p>Fosscord community spaces includes Fosscord github repositories and Fosscord development guilds (be it on Discord.com or Fosscord instances mananged by the Fosscord maintainers group).</p> <p>By contributing to any Fosscord projects (for example, through pull request) you guarantee that you have the rights to resign all rights to Fosscord under the AGPLV3 license.</p>"},{"location":"contributing/conduct/#desirable-behaviour","title":"Desirable Behaviour","text":"<ul> <li>If possible, provide assistance with Fosscord projects to other users.</li> <li>Be respectful toward other's opinions and viewpoints.</li> <li>Accepting responsibility and apologizing to those affected for our mistakes.</li> </ul>"},{"location":"contributing/conduct/#prohibited-behaviour","title":"Prohibited Behaviour","text":"<ul> <li>Sharing leaked, proprietary source code from Discord Inc</li> <li>Homophobia, transphobia, etc, misgendering, deadnaming, assuming gender. You should use singular they/them when in doubt.</li> <li>Threats of violence</li> <li>Harassment</li> <li>Spreading hateful, violent, or discriminatory ideologies or conspiracy theories, via media or text (including avatars and nicknames)</li> <li>Trolling. Intentionally derailing conversations or producing discussions on non-issues.</li> <li>Doxing. Disclosing other's private information without their consent.</li> <li>Spamming. This includes sending advertisements, repeatedly sending meaningless content, sending server invites unrequested.</li> <li>Sharing media that may cause harm or be triggering to others, such as flashing imagery or gore.</li> <li>Undesired automation of services that may lead to a reduction in service quality. For example, API spam of a Fosscord instance.</li> <li>Ban evasion. Creation of additional accounts used to join a community after being banned from that community.</li> <li>Posting content that is illegal to publish or distribute in Germany.</li> <li>Abusing loopholes in this code of conduct, or being in conflict with the goals of this code of conduct.</li> </ul>"},{"location":"contributing/conduct/#consequences-of-violation","title":"Consequences of Violation","text":"<ul> <li>Written warnings, followed by kicks or bans if repeated.</li> <li>If a violation is particularly egregious, an immediate kick or ban may be issued.</li> <li>Offending content may be removed</li> <li>Kicks and bans apply to all communities administered by the Fosscord maintainers group.</li> </ul>"},{"location":"contributing/conduct/#reporting-problems","title":"Reporting problems","text":"<p>You may report any violation of this code of conduct to the Fosscord community team directly through Discord, private message or otherwise.</p> <p>If you believe us to be in violation of this code of conduct, please report it to someone in a higher position, or to many people on the team. Make sure to provide a direct quote from here to be as effective as possible.</p>"},{"location":"contributing/conduct/#changes-to-this-document","title":"Changes to this document","text":"<p>This code of conduct may be changed in order to enhance clarity and precision at any time. Notification should be provided</p>"},{"location":"setup/","title":"Setup","text":""},{"location":"setup/#server","title":"Server","text":""},{"location":"setup/#bots","title":"Bots","text":""},{"location":"setup/#clients","title":"Clients","text":""},{"location":"setup/bots/","title":"Bots and Applications","text":"<p>Fosscord is backwards-compatibile with Discord.com, and so all existing bots and applications designed for Discord.com should work relatively easily when connected to a Fosscord instance instead.</p> <p>The Discord Developer Panel is available at /developers, and allows you all the same functionality to create bots and applications on a Fosscord instance as Discord.com.</p>"},{"location":"setup/bots/#bot-libraries","title":"Bot Libraries","text":""},{"location":"setup/bots/#discordjs","title":"Discord.js","text":"<p>The <code>Client</code> class constructor accepts a <code>http</code> object, which you can use to change the endpoints used.</p> <pre><code>const { Client } = require(\"discord.js\");\n\nconst client = new Client({\nhttp: {\nversion: 9,\napi: \"https://api.fosscord.com\",\ncdn: \"https://cdn.fosscord.com\",\ninvite: \"https://fosscord.com/invite\",\n},\n});\n\nclient.login(\"your token here\");\n</code></pre>"},{"location":"setup/bots/#discordpy","title":"Discord.py","text":"<pre><code>import discord\n\ndiscord.http.Route.BASE = \"https://api.fosscord.com\"\nclient = discord.Client()\n\nclient.run('your token here')\n</code></pre>"},{"location":"setup/bots/#jda","title":"JDA","text":"<pre><code>import java.lang.reflect.*;\nimport net.dv8tion.jda.internal.requests.*;\n\npublic static void main(String[] args) {\nJDA jda = JDABuilder.createDefault(\"your token here\").build();\n\nField field = Requester.class.getDeclaredField(\"DISCORD_API_PREFIX\")\nfield.setAccessible(true);\n\nField modifiers = Field.class.getDeclaredField(\"modifiers\");\nmodifiers.setAccessible(true);\nmodifiers.setString(field, field.getModifiers() &amp; ~Modifier.FINAL);\n\nfield.set(null, \"https://api.fosscord.com\");\n}\n</code></pre>"},{"location":"setup/clients/","title":"Clients","text":""},{"location":"setup/clients/#using-your-discordcom-desktop-client-with-a-fosscord-instance","title":"Using your Discord.com desktop client with a Fosscord instance","text":"Environment Variablessettings.jsonWebcordHost the proxy yourself <p>This assumes your Fosscord instance has the Test Client enabled, and erlpack installed.</p> <p>Set the <code>DISCORD_WEBAPP_ENDPOINT</code> environment variable on the machine running the client to the Fosscord web app URL, for example <code>https://staging.fosscord.com</code>.</p> <p>On Windows:</p> <ol> <li>Open the start menu and search for \"Environment variables\"</li> <li>Click \"Environment Variables\" at the bottom of this new window, titled \"System Properties\"</li> <li>Add a new user variable</li> <li>Set the name to <code>DISCORD_WEBAPP_ENDPOINT</code>, and the value to your instance URL.</li> </ol> <p>On Linux, you can:</p> <ul> <li>run <code>DISCORD_WEBAPP_ENDPOINT=instance url discord</code> on the CLI</li> <li>edit the <code>discord.desktop</code> file to include the above</li> <li>add <code>EXPORT DISCORD_WEBAPP_ENDPOINT=url</code> to your bash/zsh/etc profile (<code>~/.bashrc</code> for example)</li> <li>and probably lots more</li> </ul> <p>This assumes your Fosscord instance has the Test Client enabled, and erlpack installed.</p> <p>You may edit your desktop client's <code>settings.json</code> file at <code>%appdata%/discord/settings.json</code> on Windows and typically <code>~/.config/discord/settings.json</code> on Linux, adding the following line</p> <pre><code>\"WEBAPP_ENDPOINT\" : \"https://your_fosscord_instance_url\"\n</code></pre> <p>such that it looks like this, as an example</p> <pre><code>{\n\"IS_MAXIMIZED\": true,\n\"IS_MINIMIZED\": false,\n\"WINDOW_BOUNDS\": {\n\"x\": 335,\n\"y\": 86,\n\"width\": 940,\n\"height\": 600\n},\n\"BACKGROUND_COLOR\": \"#202225\",\n\"WEBAPP_ENDPOINT\": \"https://your_fosscord_instance_url\"\n}\n</code></pre> <p>This assumes your Fosscord instance has the Test Client enabled.</p> <p>Webcord does not currently allow specifcying custom instance URLs. The available instances with Webcord are https://app.freecord.ir and staging.fosscord.com.</p> <ol> <li>Download and install Webcord</li> <li>In the top bar, \"File\" -&gt; \"Settings\"</li> <li>Scroll down to \"Discord Instance\" and select a Fosscord instance you would like to use</li> </ol> <p>If an instance does not have the test client enabled, you can host the proxy yourself, and simply set it to use your desired Fosscord instance.</p>"},{"location":"setup/server/","title":"Server Setup","text":"<p>Fosscord-server setup ranges in difficulty depending on how you want to configure your system. This page provides a minimal setup guide to get you up and running, you should check out the other pages on this site to take your instance to the next level.</p> <p>For this guide, we assume you're familar with the terminal.</p> <p>We do not recommend or support running Fosscord using services such as Ngrok or Heroku. You must have access to a terminal for this guide.</p> <p>We do not recommend using Windows to run Fosscord.</p>"},{"location":"setup/server/#dependencies","title":"Dependencies","text":"<ul> <li>Git</li> <li>NodeJS. Version 16+</li> <li>Python. Version 3+. Make sure this is executable via <code>python</code> in your terminal.     (See: <code>python-is-python3</code> package)</li> <li>On Linux: <code>gcc</code>/<code>g++</code>. Packaged with <code>build-essential</code> on Debian/Ubuntu and <code>base-devel</code> on Arch.</li> <li>On Windows: Visual Studio (NOT VSCode) with the <code>Desktop development with C++</code> package.     You do not need the full Visual Studio install, the build tools are fine.</li> </ul>"},{"location":"setup/server/#setup","title":"Setup","text":"<p>In your terminal:</p> <pre><code># Download Fosscord\ngit clone https://github.com/fosscord/fosscord-server.git\n\n# Navigate to project root\ncd fosscord-server\n\n# Install javascript packages\nnpm i\n\n# Build and generate schema. Separately, they are `build` and `generate:schema`.\nnpm run setup\n\n# Start the bundle server ( API, CDN, Gateway in one )\nnpm run start\n</code></pre> <p>If all went according to plan, you can now access your new Fosscord instance at http://localhost:3001! Congrats!</p> <p>If you set up your server remotely, you can use <code>curl http://localhost:3001/api/ping</code> to verify the server is up and running, (you should set up a reverse proxy, next!).</p>"},{"location":"setup/server/#now-what","title":"Now what?","text":"<p>Well, now you can configure Fosscord to your liking!</p> <ul> <li>Skip to test client configuration</li> <li>Skip to server configuration</li> <li>Skip to reverse proxy / SSL</li> <li>Skip to security</li> </ul>"},{"location":"setup/server/database/","title":"Database","text":"<p>By default, Fosscord will use SQLite. SQLite is nice for testing or development, but if you plan to run an instance with any sort of demand, you'd best set up a more Proper\u2122 database such as MariaDB or PostreSQL, which are both popular choices within the community.</p> <p>We won't go into the setup of these servers here, given the scope of our documentation, but to configure Fosscord to use your shiny new database, simply set the <code>DATABASE</code> environment variable to your new database connection string.</p> <p>Usually, such a string will look something like <code>type://username:password@your-IP/databaseName</code></p>"},{"location":"setup/server/migatingFromStaging/","title":"Migrating from Staging","text":"<p>'Staging' refers to this branch of fosscord-server, which is deprecated in favour of the refactor branch (if this is a 404, its just become the main branch now).</p> <p>If you were using SQLite, you will be unable to migrate to the new version. SQLite is primarily for testing and development purposes, and it should not be used for production.</p> <p>To migrate from Staging:</p> <ol> <li>Download the new version of fosscord-server <code>git clone https://github.com/fosscord/fosscord-server.git</code></li> <li>Copy your <code>.env</code> file from your previous installation to the new <code>fosscord-server</code> folder.</li> <li>Copy any user data, specifically the <code>files</code> directory, to the new project root.</li> <li><code>npm i</code> in new installation</li> <li><code>npm run setup</code></li> <li><code>npm run migrate-from-staging</code> to run the migrations on your database</li> <li><code>npm run start</code> to start the server</li> </ol> <p>Make sure you modify any existing scripts of yours to use the new path, or just rename the old one and move the new one in its place.</p>"},{"location":"setup/server/npmScripts/","title":"NPM scripts","text":"<p>Can be executed using <code>npm run {script name}</code></p>"},{"location":"setup/server/npmScripts/#setup","title":"<code>setup</code>","text":"<p>Shorthand for <code>build</code> and <code>generate:schema</code></p>"},{"location":"setup/server/npmScripts/#syncdb","title":"<code>sync:db</code>","text":"<p>Syncronise the database schema between Fosscord source code and your database. May incur data loss. You do not normally need to run this script, as Fosscord-server will perform it when necessary.</p>"},{"location":"setup/server/npmScripts/#build","title":"<code>build</code>","text":"<p>Builds the Fosscord source code</p>"},{"location":"setup/server/npmScripts/#start","title":"<code>start</code>","text":"<p>Starts the bundled server. API, Gateway, and CDN run under the same process when using bundle, using the same port.</p>"},{"location":"setup/server/npmScripts/#startapi-startgateway-startcdn","title":"<code>start:api</code>, <code>start:gateway</code>, <code>start:cdn</code>","text":"<p>Starts the respective component.</p>"},{"location":"setup/server/npmScripts/#generateclient","title":"<code>generate:client</code>","text":"<p>Downloads a (mostly) complete discord.com web client and runs some basic patches:</p> <ul> <li>Replaces all mentions of \"Server\" -&gt; \"Guild\"</li> <li>Replaces \"Discord\" -&gt; \"Fosscord\"</li> <li>\"Nitro\" -&gt; \"Premium\"</li> <li>Replaces the Discord logo home button with a Fosscord logo</li> <li>Prevents <code>localStorage</code> deletion (for plugins)</li> <li>Adds <code>fast-identify</code> support</li> </ul> <p>The script can only search for all javascript client files, as it is difficult to determine the filetype of other assets. Instead, it uses a <code>cacheMisses</code> file in <code>fosscord-server/assets</code> generated at server runtime.</p>"},{"location":"setup/server/npmScripts/#fast-identify","title":"fast-identify","text":"<p>Essentially, it's a small mod to the fast-connect script Discord clients already use, which sends a small <code>IDENTIFY</code> payload to the server, which speeds up how fast we receive <code>READY</code>. Without the client patch however, the <code>READY</code> payload received will just be ignored by the client, and it'll attempt to re-auth after a few seconds.</p>"},{"location":"setup/server/npmScripts/#generaterights","title":"<code>generate:rights</code>","text":"<p>Generates a Discord.com-like rights value for use as a default right. Also displays the 'all rights' value, which <code>1</code> is a placeholder for.</p>"},{"location":"setup/server/npmScripts/#generatechangelog","title":"<code>generate:changelog</code>","text":"<p>Injects the changelog at <code>fosscord-server/assets/changelog.txt</code> into the Discord.com client.</p>"},{"location":"setup/server/npmScripts/#generateschema","title":"<code>generate:schema</code>","text":"<p>Recreates the <code>fosscord-server/assets/schema.json</code> file, which is used for API and Gateway request validation.</p>"},{"location":"setup/server/reverseProxy/","title":"Reverse Proxy","text":""},{"location":"setup/server/reverseProxy/#nginx","title":"NGINX","text":"<p>Generally, our community sets up Fosscord instances behind NGINX, a powerful reverse proxy.</p> <p>Below is an example NGINX config. On Ubuntu, you can put this in the <code>/etc/nginx/sites-available/fosscord.conf</code> file, and enable it with <code>ln -s /etc/nginx/sites-available/fosscord.conf /etc/nginx/sites-enabled/</code> and <code>systemctl restart nginx</code></p> <p>Info</p> <p>Other distros, and Windows, may not have a <code>sites-available</code>, <code>sites-enabled</code> directory structure. You may need to edit the <code>/etc/nginx/nginx.conf</code> file instead, or place new files in a <code>conf.d</code> directory, for example. Check which directories exist on your system to be sure.</p> <pre><code>server {\n# Change server_name\nserver_name fosscord.example.com;\nlisten 80;\n\nlocation / {\n# Only change this if Nginx and Fosscord are not on the same machine.\nproxy_pass http://127.0.0.1:3001;\nproxy_set_header Host $host;\nproxy_pass_request_headers      on;\nadd_header Last-Modified $date_gmt;\nadd_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';\nproxy_set_header  X-Real-IP $remote_addr;\nproxy_set_header  X-Forwarded-Proto https;\nproxy_set_header  X-Forwarded-For $remote_addr;\nproxy_set_header  X-Forwarded-Host $remote_addr;\nproxy_no_cache 1;\nproxy_cache_bypass 1;\n\n# This is important. It allows Websocket connections through NGINX.\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\n}\n\n# Uncomment this if using Imagor:\n#location /media {\n#   # If you changed the port, be sure to change it here too\n#   proxy_pass http://127.0.0.1:8000;\n#}\n}\n}\n</code></pre>"},{"location":"setup/server/reverseProxy/#ssl","title":"SSL","text":"<p>SSL is a technology used to keep your website secure. Put very simply, it's the padlock next to the URL in your browser.</p> <p>After you've set up NGINX, it's very simple to also set up SSL using <code>certbot</code>.</p> UbuntuArchOther Distros <pre><code>sudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx\n</code></pre> <pre><code>sudo pacman -Syu certbot certbot-nginx\nsudo certbot --nginx\n</code></pre> <p>Please refer to Certbots documentation</p> <p>You should be asked various questions, such as which site you want to enable SSL for. After which, you should now have a SSL secured Fosscord instance!</p> <p>But wait, there's more! If you have changed your <code>gateway_endpointPublic</code> or <code>cdn_endpointPublic</code> addresses, you'll probably have to update those to use the new protocol (<code>https</code> or <code>wss</code>).</p>"},{"location":"setup/server/systemd/","title":"SystemD","text":"<p>Below is an example SystemD service for running Fosscord. Save it in <code>/etc/systemd/system/fosscord.service</code>.</p> <pre><code>[Unit]\nDescription=Fosscord, for better and secure communication\n\n[Service]\nUser=&lt;your user&gt;\nWorkingDirectory=&lt;fosscord directory&gt;\nExecStart=npm run start\nRestart=always\nStandardError=journal\nStandardOutput=journal\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Do not run Fosscord as the root user. This is a security risk to your system.</p> <p>Make sure to edit the file as needed, such as replacing the user. It is a good idea to create a new user on your system to run Fosscord. If you would like to run the API, CDN or Gateway separately, you can edit the <code>ExecStart</code> command used in line with the npm script. Also be sure to run RabbitMQ in that case.</p> <p>You can now start Fosscord using <code>sudo systemctl start fosscord</code>.</p> <p>To automatically run Fosscord on boot, use <code>sudo systemctl enable fosscord</code>.</p> <p>To view the server logs, you may use <code>journalctl -u fosscord</code>, or with <code>-f</code> to view them as they come.</p> <p>You may also use the <code>lnav</code> package to get nice, colourised and scrolling output: <code>journalctl -xefu fosscord | lnav</code></p>"},{"location":"setup/server/updating/","title":"Updating","text":"<p>If you had followed the setup guide, you'll have installed Fosscord using Git. Thus, you can update the server by running <code>git pull</code> in the <code>fosscord-server</code> directory.</p> <p>If you had made any changes locally, you may run into merge conflicts, where the Fosscord team has made changes to the same code you changed. If it's not important to you, you can simply run <code>git reset --hard HEAD</code> which will delete all your changes. If you want to keep them, you'll have to go through each conflict and resolve them.</p> <p>After downloading the new version, go through the setup guide as normal again:</p> <pre><code># Install any new javascript packages\nnpm i\n\n# Build and generate schema\nnpm run setup\n\n# Start the server\nnpm run start\n</code></pre>"},{"location":"setup/server/Test%20Client/","title":"Test Client","text":"<p>The test client included with fosscord-server is deprecated and will be removed in favour of Discord-Client-Proxy in the future</p> <p>The test client is a proxy to the Discord.com client used for development purposes. You can enable the test client by setting the <code>client_useTestClient</code> config value in your database.</p>"},{"location":"setup/server/Test%20Client/#how-it-works","title":"How it works","text":"<p>By editing the <code>GLOBAL_ENV</code> variable used by the client, we can trick it into sending requests to the API/Gateway/CDN/etc to us, instead of Discord.com. We simply proxy it from Discord.com otherwise.</p>"},{"location":"setup/server/Test%20Client/#updating","title":"Updating","text":"<p>To update the client version served, edit the 4 <code>&lt;script&gt;</code> tags in the <code>&lt;body&gt;</code> of <code>assets/client_test/index.html</code>, with ones used by a client version you wish to use. To get the latest client scripts, simply download the HTML served by https://discord.com/app (through <code>wget https://discord.com/app</code>, for example) Do not replace the <code>assets/client_test/index.html</code> file with a fresh one from Discord.com, as there are additional changes made to the file by the Fosscord team.</p>"},{"location":"setup/server/Test%20Client/#theming","title":"Theming","text":""},{"location":"setup/server/Test%20Client/#plugins","title":"Plugins","text":""},{"location":"setup/server/Test%20Client/plugins/","title":"Plugins","text":"<p>There is no plugin API available to use with the test client currently. You cannot install BetterDiscord, Powercord/Replugged, or other client mod plugins without heavy modification at this time.</p> <p>However, you can install Vencord quite easily with only slight modifications to the user script.</p> <p>For instances you control, simply find and replace all mentions of <code>GM_xmlhttpRequest</code> with <code>new XMLHttpRequest</code>, and <code>unsafeWindow</code> with <code>window</code>. Throw the edited file into the <code>assets/preload-plugins</code> directory, restart the server, and you now have Vencord installed instance-wide!</p> <p>If you want to install Vencord on instances you do not control, do not perform any of the above steps, and simply modify the <code>@match</code> line at the top to include the instance(s). For staging.fosscord.com:</p> <pre><code>// @match *://*.staging.fosscord.com/*\n</code></pre> <pre><code>You may now install the modified user script in your favourite user script browser extension, such as [Tampermonkey](https://www.tampermonkey.net/)\n</code></pre>"},{"location":"setup/server/Test%20Client/theming/","title":"Theming","text":"<p>'Theming' here refers to the theming of the test client. Fosscord can inject additional CSS into the client to allow you to change quite a lot about it's appearence.</p> <p>There's three different CSS files injected into the client, in <code>/assets/public</code>, including <code>fosscord-login.css</code>, <code>fosscord.css</code>, and <code>user.css</code>. Fosscord developers may make changes to <code>fosscord.css</code> occasionally, so it's best to not touch this. <code>user.css</code> and <code>fosscord.css</code> are applied to all routes in the client, while <code>fosscord-login.css</code> is only applied to the login/register routes.</p> <p>You can essentially throw any BetterDiscord/Replugged CSS theme into the <code>users.css</code> file and, given it was designed for the same client version, it'll work.</p>"},{"location":"setup/server/configuration/","title":"Configuration","text":"<p>Fosscord's configuration is done through the <code>config</code> table of your database. The table schema consists of two columns <code>key</code> and <code>value</code>, where <code>value</code> is a JSON value. For now, you can update this through SQL manually or a GUI database editor such as DBeaver.</p> <p>The <code>CONFIG_PATH</code> environment variable can be set to make Fosscord use a JSON file instead of a database table.</p>"},{"location":"setup/server/configuration/#array-types","title":"Array Types","text":"<p>Arrays are represented by _[number] in a config key. For example, multiple <code>guild_defaultFeatures</code> may be assigned such as</p> key value <code>guild_defaultFeatures_0</code> <code>DISCOVERABLE</code> <code>guild_defaultFeatures_1</code> <code>ANIMATED_ICON</code> etc etc"},{"location":"setup/server/configuration/#available-configuration-options","title":"Available Configuration Options","text":"key default type description gateway_endpointClient null string Injected into index.html if available gateway_endpointPrivate null string Used for internal communication with gateway gateway_endpointPublic null string Publicly announced gateway endpoint cdn_endpointClient null string See gateway_endpointClient cdn_endpointPrivate http://localhost:3001 string See gateway_endpointPrivate cdn_endpointPublic http://localhost:3001 string See gateway_endpointPublic cdn_resizeHeightMax 1000 number Maximum image resize height for embeds. cdn_resizeWidthMax 1000 number Maximum image resize width for embeds. cdn_imagorServerUrl null string Imagor instance endpoint for external image resizing. api_defaultVersion 9 string API version to use when not specified api_activeVersions_0 6, 7, 8, 9 string[] Allowed API version numbers. Array. general_instanceName Fosscord Instance string Announced instance name general_instanceDescription This is a Fosscord instance made in the pre-release days string Announced instance description general_frontPage null string Announced instance front page general_tosPage null string Announced instance TOS page general_correspondenceEmail null string Announced instance correspondence email general_correspondenceUserID null string Announced instance correspondence ID (from this instance) general_image null string Announced instance image URL general_instanceId Snowflake of instance creation date Snowflake Announced instance ID limits_user_maxGuilds 1048576 number Maxmimum guilds a user can join limits_user_maxUsername 127 number Maximum username length limits_user_maxFriends 5000 number Maximum number of friends per user limits_guild_maxRoles 1000 number Maximum number of roles in a guild limits_guild_maxEmojis 2000 number Maximum number of emojis in a guild limits_guild_maxMembers 25000000 number Maximum number of members in a guild limits_guild_maxChannels 65535 number Maximum number of channels in a guild limits_guild_maxChannelsInCategory 65535 number Maximum number of channels per category in a guild limits_message_maxCharacters 1048576 number Maximum character count per message limits_message_maxTTSCharacters 160 number Maximum character count per text to speech messages limits_message_maxReactions 2048 number Maximum number of reactions per message limits_message_maxAttachmentSize 1073741824 number Maximum total attachment size per message limits_message_maxBulkDelete 1000 number Maximum number of messages deletable through bulk delete limits_message_maxEmbedDownloadSize 5242880 number Maximum download size of external embeddable content limits_channel_maxPins 500 number Maximum number of pins per channel limits_channel_maxTopic 1024 number Maximum channel topic character length limits_channel_maxWebhooks 100 number Maximum number of webhooks per channel limits_rate_enabled true boolean Whether rate limits are enabled limits_rate_ip_count 500 number Allowed number of requests per IP within window limits_rate_ip_window 5 number IP rate limit window, in seconds limits_rate_global_count 250 number Allowed number of requests globally within window limits_rate_global_window 5 number Global rate limit window, in seconds limits_rate_error_count 10 number Number of allowed errors per user within window limits_rate_error_window 5 number User error rate limit window, in seconds limits_rate_routes_guild_count 5 number Allowed number of /guild* requests per user within window limits_rate_routes_guild_window 5 number User /guild* rate limit window, in seconds limits_rate_routes_webhook_count 10 number Allowed number of /webhooks* requests per user within window limits_rate_routes_webhook_window 5 number User /webhooks* rate limit window, in seconds limits_rate_routes_channel_count 10 number Allowed number of /channel* requests per user within window limits_rate_routes_channel_window 5 number User /channel* rate limit window, in seconds limits_rate_routes_auth_login_count 5 number Allowed number of IP /login requests within window limits_rate_routes_auth_login_window 60 number IP /login rate limit window, in seconds limits_rate_routes_auth_register_count 2 number Allowed number of IP /register requests within window limits_rate_routes_auth_register_window 43200 number IP /register rate limit window, in seconds limits_absoluteRate_register_limit 25 number Absolute number of registrations instance-wide per window limits_absoluteRate_register_window 3600000 number Global /register rate limit window, in seconds limits_absoluteRate_register_enabled true boolean Whether absolute register rate limits are enabled limits_absoluteRate_sendMessage_limit 200 number Absolute number of messages instance-wide per window limits_absoluteRate_sendMessage_window 60000 number Global sendMessage window, in seconds limits_absoluteRate_sendMessage_enabled true boolean Whether absolute message sending rate limits are enabled security_captcha_enabled false boolean Whether to enable captchas for login/register security_captcha_service null \"recaptcha\"/\"hcaptcha\" Which captcha service to use security_captcha_sitekey null string Captcha service sitekey security_captcha_secret null string Captcha service secret security_twoFactor_generateBackupCodes true boolean Whether to generate backup codes for MFA users security_requestSignature Secret secret string The signature required for CDN or Imagor usage security_jwtSecret Secure secret string The secret used for user token generation security_forwadedFor null string HTTP header for user's real IP. security_ipdataApiKey Fosscord IPdata key string API key used for IP geolocation and proxy detection security_mfaBackupCodeCount 10 number Number of MFA backup codes to generate security_statsWorldReadable true boolean Whether instance stats are publically accessible or require right security_defaultRegistrationTokenExpiration 604800000 number Seconds for registration tokens to expire login_requireCaptcha false boolean Whether login requires captcha verification register_email_required false boolean Whether an email is required for registration register_email_allowlist false boolean Whether <code>register_email_domains</code> is an allowlist register_email_blocklist true boolean Whether <code>register_email_domains</code> is a blocklist register_email_domains [] string[] The email domains list to use as a block/allow list register_dateOfBirth_required true boolean Whether a date of birth is required for registration register_dateOfBirth_minimum 13 number The minimum age of registration register_password_required false boolean Whether a password is required for registration register_password_minLength 8 number Minimum password length register_password_minNumbers 2 number Minimum number of number characters in passwords register_password_minUpperCase 2 number Minimum number of uppercase characters in passwords register_password_minSymbols 0 number Minimum number of symbols in passwords register_disabled false boolean Whether registration is disabled register_requireCaptcha true boolean Whether registration requires captcha verification register_requireInvite false boolean Whether registration requires a guild invite register_guestsRequireInvite true boolean Whether guests accounts require a guild invite register_allowMultipleAccounts true boolean Allow multiple accounts with the same client fingerprint register_blockProxies true boolean Whether proxies are blocked from registration register_incrementingDiscriminators false boolean Whether discriminators are random or incrementing register_defaultRights 30644591655940 string The rights assigned to users upon registration regions_default fosscord string The default voice region to use regions_useDefaultAsOptimal true boolean Whether to calculate closest or use default as optimal voice region regions_available_0_id fosscord string[] The available voice region IDs regions_available_0_name Fosscord string[] The available voice region names regions_available_0_endpoint 127.0.0.1:3004 string[] The available voice region endpoint URLs regions_available_0_vip false boolean[] Whether this voice region is VIP exclusive regions_available_0_custom false boolean[] Whether this is a custom voice region (used for events/etc) regions_available_0_deprecated false boolean[] Whether this is a deprecated voice region (clients avoid these) guild_discovery_showAllGuilds false boolean Whether guild discovery should show all guilds guild_discovery_limit 24 number Maximum number of guild discovery elements per page guild_autoJoin_enabled true boolean Whether users auto join guild(s) on registration guild_autoJoin_canLeave true boolean Whether users can leave the auto-joined guild(s) guild_defaultFeatures_0 null string Features automatically granted to guilds upon creation gif_enabled true boolean Whether GIF features are enabled gif_provider tenor \"tenor\" Which GIF service to use gif_apiKey LIVDSRZULELA string GIF service API key rabbitmq_host null string RabbitMQ connection string templates_enabled true boolean Whether guild templates are enabled templates_allowTemplateCreation true boolean Whether new guild templates can be created templates_allowDiscordTemplates true boolean Whether guild templates from Discord.com can be fetched templates_allowRaws true boolean Whether raw guild templates are allowed client_useTestClient false boolean Whether the Discord.com test client is enabled sentry_enabled false boolean Whether server-side Sentry analytics is enabled sentry_endpoint Fosscord sentry endpoint string Sentry endpoint sentry_traceSampleRate 1 number Sentry sample rate (1 means all requests) sentry_environment System hostname string Sentry environment name defaults_user_premium false boolean Whether users are given premium upon registration defaults_user_premium_type 2 number The premium type given to users upon registration defaults_user_verified true boolean Whether users get verified email upon registration external_twitter null string Twitter API key used for Twitter embeds"},{"location":"setup/server/configuration/embeds/","title":"Embeds","text":"<p>Embeds in Fosscord are external content that is displayed within your messages when linked to. Fosscord tries its best to fetch content from these external sites, but sometimes we require an API key or other authentication with the site to display their content (or nicer looking embeds).</p> <p>For external images, it's best to set up Imagor for image resizing. The client may or may not fetch images directly from their source if this is not set up, and as such some users may not see all images. In the case where a client does fetch an image from it's source, without Imagor an attacker may be able to learn the IP addresses of users.</p>"},{"location":"setup/server/configuration/embeds/#twitter","title":"Twitter","text":"<p>Go to the Twitter developer portal and sign up for developer access. You must have a phone number attached to your account to sign up. Create an application for use with the Twitter API (We don't need to post messages to Twitter itself). Make sure to create a bearer token for authentication. Once you have your API key, set the <code>external_twitter</code> config value to your API key, wrapped in quotes.</p>"},{"location":"setup/server/configuration/env/","title":"Environment Variables","text":"<p>Below is a list of environment variables used by Fosscord. You can set environment variables easily by creating an <code>.env</code> file in the <code>fosscord-server</code> folder, with the format <code>NAME=VALUE</code> with each on new lines.</p> Name Value Description THREADS number Number of threads to run Fosscord on when using bundle. Make sure you've enabled RabbitMQ if using more than one PORT number Port to listen on. Used by all components, including bundle. If using bundle, all components run under the same port DATABASE string Database connection string. Defaults to SQlite3 at project root CONFIG_PATH string File path for JSON config, if not using <code>config</code> db table WS_LOGEVENTS boolean If set, log websocket events except messages from gateway WS_VERBOSE boolean If set, log websocket messages sent/received by gateway WS_DUMP boolean If set, dump websocket messages sent/received to disk CDN string Lowest priority value for public CDN annoucements GATEWAY string Lowest priority value for public gateway annoucements STORAGE_LOCATION string CDN storage location. File path or S3 bucktet STORAGE_PROVIDER \"s3\" or \"file\" CDN storage provider STORAGE_BUCKET string S3 bucket name STORAGE_REGION string S3 storage region"},{"location":"setup/server/configuration/guildFeatures/","title":"Guild Features","text":"<p>Guild features are special modifiers assigned to guilds for additional functionality.</p> <p>In Fosscord, guild features are stored in the <code>features</code> column of the <code>guilds</code> table as a comma separated list, with no spaces. For example, <code>ANIMATED_ICON,BANNER,DISCOVERABLE</code>.</p> <p>A list of all guild features is available here</p>"},{"location":"setup/server/configuration/imagor/","title":"Imagor","text":"<p>Imagor is a \"fast, secure image processing server\" used by Fosscord for external image resizing, primarily by embeds from other websites when linked in a message. If left unused, Fosscord will simply not provide a proxy_url for clients, which may leave external images unavailable or cause the client to download directly from the image host. Downloading images directly from the host may lead to privacy concerns, as an attacker may be able to learn users IP addresses.</p>"},{"location":"setup/server/configuration/imagor/#dependencies","title":"Dependencies","text":"<ul> <li>Docker</li> </ul>"},{"location":"setup/server/configuration/imagor/#setup","title":"Setup","text":"<p>To setup Imagor for Fosscord, first grab the <code>security_requestSignature</code> config value from Fosscord's database, and create a <code>imagor.env</code> file somewhere safe, with the following content (do not include the <code>[]</code>)</p> <pre><code>IMAGOR_SECRET=[security_requestSignature value]\nPORT=8000\n</code></pre> <p>You can now start Imagor with</p> <pre><code>docker run --env-file ./imagor.env -p 8000:8000 shumc/imagor\n</code></pre> <p><code>8000</code> here is our port. Make sure that it'd available to people outside your network. If you would like to change the port Imagor listens on, be sure to change both the PORT value in <code>imagor.env</code>, and the <code>-p</code> value used in docker.</p> <p>If you're using a reverse proxy such as Nginx for Fosscord already, you could add this to your config's <code>server</code> block</p> <pre><code>location /media {\n# If you changed the port, be sure to change it here too\nproxy_pass http://127.0.0.1:8000;\n}\n</code></pre> <p>Along with any additional config you already have, of course. Alternative (and perhaps the better choice) would be to create a new domain, say <code>media.whatever.com</code> specifically for Imagor.</p> Example config for <code>media.whatever.com</code> site <pre><code>server {\n# Change the server_name to reflect your true domain\nserver_name media.whatever.com\n\nadd_header Last-Modified $date_gmt;\nproxy_set_header Host $host;\nproxy_pass_request_headers on;\nproxy_set_header X-Forwarded-For $remote_addr;\n\nlocation / {\n# If you had changed the port, change it here as well\nproxy_pass http://127.0.0.1:8000;\n}\n}\n</code></pre> <p>Our last step is to simply tell Fosscord about Imagor. Just set the <code>cdn_imagorServerUrl</code> config value to your public endpoint for Imagor, wrapped in quotes.</p> <p>Congrats! After a restart, you've now got Imagor resizing your images!</p>"},{"location":"setup/server/configuration/rabbitmq/","title":"RabbitMQ","text":"<p>RabbitMQ is an open source message broker. Fosscord can be configured to use it for communication between the API server and Gateway server. RabbitMQ is required to be set up when you run the API and Gateway servers separately (outside of bundle). Without it, the Gateway server won't know when you send new events for things such as message creation. In the message create case, you will be able to send messages, but will have to reload the client to view new messages from others.</p> <p>After you've downloaded and installed RabbitMQ, edit Fosscord's config, set <code>rabbitmq_host</code> to <code>\"amqp://guest:guest@host:5672\"</code></p> <p>The <code>guest</code> RabbitMQ account can only be accessed via localhost, by default. If you want to run Fosscord over multiple systems, you'll need to set up access control in RabbitMQ.</p>"},{"location":"setup/server/configuration/userFlags/","title":"User Flags","text":"<p>User flags describe special properties of users, including whether they are staff, a verified bot, a bug hunter, etc.</p> <p>You can change a user's flags by setting the <code>public_flags</code> value in the <code>users</code> table. You can assign multiple flags by simply summing the respective values.</p> <p>A list of all user flags is available here</p>"},{"location":"setup/server/security/","title":"Security","text":"<p>There are various security measures available to instance owners.</p>"},{"location":"setup/server/security/#rights","title":"Rights","text":""},{"location":"setup/server/security/#captchas","title":"Captchas","text":""},{"location":"setup/server/security/#registration-tokens","title":"Registration Tokens","text":""},{"location":"setup/server/security/#rate-limits","title":"Rate Limits","text":""},{"location":"setup/server/security/captcha/","title":"CAPTCHAs","text":"<p>Fosscord currently supports two CAPTCHA providers; reCAPTCHA and hCaptcha.</p> hCaptchareCAPTCHA <ol> <li>Navigate to https://www.hcaptcha.com/</li> <li>Create an account - <code>Add hCaptcha for Publishers to my website or app</code></li> <li>Copy your <code>sitekey</code> to the config <code>security_captcha_sitekey</code> value, wrapped in quotes</li> <li>Copy your <code>secret</code> to the config <code>security_captcha_secret</code> value, wrapped in quotes</li> <li>Set the config <code>security_captcha_service</code> value to <code>\"hcaptcha\"</code></li> <li>Set the  <code>security_captcha_enabled</code> value to <code>true</code>, not wrapped in quotes.</li> </ol> <ol> <li>Navigate to https://www.google.com/u/1/recaptcha/admin/create</li> <li>Fill in your websites details</li> <li>Select <code>reCAPTCHA v2</code> -&gt; <code>\"I'm not a robot\" Checkbox</code></li> <li>Add your domain. For example, <code>staging.fosscord.com</code>. Go to the next screen.</li> <li>Copy your <code>sitekey</code> to the config <code>security_captcha_sitekey</code> value, wrapped in quotes</li> <li>Copy your <code>secret</code> to the config <code>security_captcha_secret</code> value, wrapped in quotes</li> <li>Set the config <code>security_captcha_service</code> value to <code>\"recaptcha\"</code></li> <li>Set the <code>security_captcha_enabled</code> value to <code>true</code>, not wrapped in quotes.</li> </ol> <p>reCAPTCHA v3 and other v2 types may or may not work.</p>"},{"location":"setup/server/security/limits/","title":"Rate Limiting","text":"<p>Fosscord has various forms of rate limiting built in. If you are logged in, you can bypass these with the <code>BYPASS_RATE_LIMITS</code> right</p> <ul> <li>Absolute rate limits, which effect all requests to a route regardless of source (<code>limits_absoluteRate_*</code>)</li> <li>User or IP specific rate limits (<code>limits_rate_*</code>)</li> </ul>"},{"location":"setup/server/security/limits/#absolute-ratelimiting","title":"Absolute ratelimiting","text":"<p>There are currently two types of absolute rate limiting:</p> <ul> <li><code>limits_absoluteRate_register_*</code> - Controls the absolute count of registrations allowed within a window. Useful for mitigating registration spam, in addition to captchas</li> <li><code>limits_absoluteRate_sendMessage_*</code> - Controls the absolute count of messages allowed to be sent within a window.</li> </ul> <p>Absolute rate limits do not consider the source of the request, only the total number of requests instance-wide.</p> <p>Both of the above are individually enabled.</p>"},{"location":"setup/server/security/limits/#userip-specific-ratelimiting","title":"User/IP specific ratelimiting","text":"<p>These rate limits are enabled with a single toggle (<code>limits_rate_enabled</code>)</p> <ul> <li><code>limits_rate_ip_*</code> - Controls the count of requests to any endpoint from a single IP over some window.</li> <li><code>limits_rate_global_*</code> - Number of requests to any endpoint for the same user and IP</li> <li><code>limits_rate_error_*</code> - Number of errors allowed per window for an IP</li> <li><code>limits_rate_routes_guild_*</code> - Guild related requests for same user and IP</li> <li><code>limits_rate_routes_webhook_*</code> - Webhook related requests for same user and IP</li> <li><code>limits_rate_routes_channel_*</code> - Channel related requests for same user and IP</li> <li><code>limits_rate_routes_auth_login_*</code> - Login requests for same user and IP</li> <li><code>limits_rate_routes_auth_register_*</code> - Register requests (successful only) for same IP</li> </ul>"},{"location":"setup/server/security/limits/#what-do-you-mean-by-window-and-count","title":"What do you mean by window and count?","text":"<p>Each ratelimiter accepts a <code>window</code> and <code>count</code>. The rate limiter tracks the number of requests to an endpoint within a <code>window</code>, in seconds. If number of requests within the last <code>window</code> seconds exceeds the <code>count</code> set, it will block the request.</p> <p>For example, setting:</p> <pre><code>limits_rate_ip_count = 10\nlimits_rate_ip_window = 1\n</code></pre> <p>will prevent all requests to any API endpoints from an IP if they exceed 10 requests in 1 second.</p>"},{"location":"setup/server/security/regTokens/","title":"Registration Tokens","text":"<p>Registration tokens are a one-time use token for allowing a new user registration to bypass various restrictions:</p> <ul> <li>Bypass <code>register_allowNewRegistrations = false</code></li> <li>Bypass <code>register_disabled = true</code></li> <li>Bypass captchas</li> <li>Bypass <code>register_allowMultipleAccounts = false</code></li> <li>Bypass <code>register_blockProxies = true</code></li> <li>Bypass <code>register_requireInvite = true</code></li> <li>Bypass <code>register_guestsRequireInvite = true</code></li> <li>Bypass absolute register rate limits</li> </ul> <p>To create a registration token, send a GET request to <code>/auth/generate-registration-tokens</code> as an account with <code>OPERATOR</code> rights.</p> <p>There are a few query parameters available. Append them to the request URL, for example <code>/auth/generate-registration-tokens?count=10&amp;plain=true</code></p> Parameter Type Default Description <code>count</code> int 1 The number of tokens to generate <code>plain</code> bool false Return a newline separated string instead of JSON <code>length</code> int 255 The length of each returned token <code>include_url</code> bool false Prefix tokens with URL to register page <p>To use a registration token, append <code>?token={your registration token}</code> to the register route. For example</p> <pre><code>https://staging.fosscord.com/register?token=some token\n</code></pre>"},{"location":"setup/server/security/rights/","title":"Rights","text":""},{"location":"setup/server/security/rights/#about","title":"About","text":"<p>Rights are instance-wide, per-user permissions for everything you may perform on the instance, such as sending messages, editing messages, or shutting down the server.</p> <p>You may modify a users rights by editing the <code>rights</code> column in the <code>users</code> table.</p> <p>The rights value is a bitfield string. To grant multiple rights you must add their values together. For example, to grant <code>CREATE_GUILDS</code> and <code>SEND_MESSAGES</code>, set their <code>rights</code> to <code>(1 &lt;&lt; 15) = 32768</code> + <code>(1 &lt;&lt; 25) = 33554432</code> = <code>33587200</code></p> <p>The default rights value given to users (set through the <code>register_defaultRights</code> config value) is generated through the <code>npm run generate:rights</code> script. The script generates a rights value that mimicks Discord.com.</p>"},{"location":"setup/server/security/rights/#operator-rights","title":"OPERATOR Rights","text":"<p>It is EXTREMELY DISCOURAGED to give OPERATOR rights to all users, or to set the default rights to OPERATOR. If your rights value is an odd number, that includes operator.</p> <p>Operator rights currently grants access to the following, in addition to all rights:</p> <ul> <li>Server shutdown through GET <code>/api/stop</code></li> <li>Registration token creation through GET <code>/api/auth/generate-registration-tokens</code></li> </ul>"},{"location":"setup/server/security/rights/#calculator","title":"Calculator","text":"<p>Rights: </p>"},{"location":"setup/server/security/rights/#available-rights","title":"Available rights","text":"Right Value When enabled <code>OPERATOR</code> 1 &lt;&lt; 0 All rights <code>MANAGE_APPLICATIONS</code> 1 &lt;&lt; 1 Ability to alter or remove others' applications <code>MANAGE_GUILDS</code> 1 &lt;&lt; 2 Same as the per-guild <code>MANAGE_GUILD</code> permission, but applies to all guilds and DM channels, can join any guild without invite <code>MANAGE_MESSAGES</code> 1 &lt;&lt; 3 Can delete or edit any message they can read <code>MANAGE_RATE_LIMITS</code> 1 &lt;&lt; 4 Add, change, define rate limits of other users, can also grant others <code>BYPASS_RATE_LIMITS</code> when combined with <code>BYPASS_RATE_LIMITS</code> and <code>MANAGE_USERS</code> <code>MANAGE_ROUTING</code> 1 &lt;&lt; 5 Create, alter, enable, disable custom message routing rules in any channel/guild <code>MANAGE_TICKETS</code> 1 &lt;&lt; 6 Respond to or resolve other users' support tickets <code>MANAGE_USERS</code> 1 &lt;&lt; 7 Create, alter, remove, ban users; create, modify, remove user groups <code>ADD_MEMBERS</code> 1 &lt;&lt; 8 Can manually add members into their guilds and group DMs <code>BYPASS_RATE_LIMITS</code> 1 &lt;&lt; 9 Makes the user exempt from all rate limits <code>CREATE_APPLICATIONS</code> 1 &lt;&lt; 10 Can create, edit, remove own applications <code>CREATE_CHANNELS</code> 1 &lt;&lt; 11 Can create guild channels and custom channels <code>CREATE_DMS</code> 1 &lt;&lt; 12 Can create 1:1 DMs (a user without <code>SEND_MESSAGES</code> cannot be added however) <code>CREATE_DM_GROUPS</code> 1 &lt;&lt; 13 Can create group DMs (a user without <code>SEND_MESSAGES</code> cannot be added however) <code>CREATE_GUILDS</code> 1 &lt;&lt; 14 Can create guilds <code>CREATE_INVITES</code> 1 &lt;&lt; 15 Can create mass invites in the guilds that they have <code>CREATE_INSTANT_INVITE</code> <code>CREATE_ROLES</code> 1 &lt;&lt; 16 Can create roles and per-guild or per-channel permission overrides in the guilds that they have permissions <code>CREATE_TEMPLATES</code> 1 &lt;&lt; 17 Can create templates for guilds, custom channels and channels with custom routing <code>CREATE_WEBHOOKS</code> 1 &lt;&lt; 18 Can create webhooks in the guilds that they have permissions <code>JOIN_GUILDS</code> 1 &lt;&lt; 19 Can join guilds by using invites or vanity names <code>PIN_MESSAGES</code> 1 &lt;&lt; 20 Can modify the pinned messages in the guilds that they have permission <code>SELF_ADD_REACTIONS</code> 1 &lt;&lt; 21 Can react to messages, subject to permissions <code>SELF_DELETE_MESSAGES</code> 1 &lt;&lt; 22 Can delete own messages <code>SELF_EDIT_MESSAGES</code> 1 &lt;&lt; 23 Can edit own messages <code>SELF_EDIT_NAME</code> 1 &lt;&lt; 24 Can edit own username, nickname and avatar <code>SEND_MESSAGES</code> 1 &lt;&lt; 25 Can send messages in the channels that they have permissions <code>USE_ACTIVITIES</code> 1 &lt;&lt; 26 Can use voice activities, such as watch together or whiteboard <code>USE_VIDEO</code> 1 &lt;&lt; 27 Can use video and screenshare in guilds/channels that they have permissions <code>USE_VOICE</code> 1 &lt;&lt; 28 Can use voice in guilds/channels that they have permissions <code>INVITE_USERS</code> 1 &lt;&lt; 29 Can create user-specific invites in guilds that they have <code>INVITE_USERS</code> <code>SELF_DELETE_DISABLE</code> 1 &lt;&lt; 30 Can delete/disable own account <code>DEBTABLE</code> 1 &lt;&lt; 31 Can use pay-to-use features once paid <code>CREDITABLE</code> 1 &lt;&lt; 32 Can earn money using monetization features in guilds that have <code>MONETIZATION_ENABLED</code> <code>KICK_BAN_MEMBERS</code> 1 &lt;&lt; 33 Can kick or ban guild or group DM members in the guilds/groups that they have KICK_MEMBERS, or BAN_MEMBERS <code>SELF_LEAVE_GROUPS</code> 1 &lt;&lt; 34 Can leave the guilds or group DMs that they joined on their own (one can always leave a guild or group DMs they have been force-added) <code>PRESENCE</code> 1 &lt;&lt; 35 Inverts the presence confidentiality default (OPERATOR's presence is not routed by default, others' are) for a given user <code>SELF_ADD_DISCOVERABLE</code> 1 &lt;&lt; 36 Can mark discoverable guilds that they have permissions to mark as discoverable <code>MANAGE_GUILD_DIRECTORY</code> 1 &lt;&lt; 37 Can change anything in the primary guild directory <code>POGGERS</code> 1 &lt;&lt; 38 Can send confetti, screenshake, random user mention (@someone) <code>USE_ACHIEVEMENTS</code> 1 &lt;&lt; 39 Can use achievements and cheers <code>INITIATE_INTERACTIONS</code> 1 &lt;&lt; 40 Can initiate interactions <code>RESPOND_TO_INTERACTIONS</code> 1 &lt;&lt; 41 Can respond to interactions <code>SEND_BACKDATED_EVENTS</code> 1 &lt;&lt; 42 Can send backdated events <code>USE_MASS_INVITES</code> 1 &lt;&lt; 43 Can accept mass (guild) invites <code>ACCEPT_INVITES</code> 1 &lt;&lt; 44 Can accept user-specific invites and DM requests <code>SELF_EDIT_FLAGS</code> 1 &lt;&lt; 45 Can modify own flags <code>EDIT_FLAGS</code> 1 &lt;&lt; 46 Can modify other's flags <code>MANAGE_GROUPS</code> 1 &lt;&lt; 47 Can manage other's groups <code>VIEW_SERVER_STATS</code> 1 &lt;&lt; 48 Can view server stats /api/policies/stats"}]}